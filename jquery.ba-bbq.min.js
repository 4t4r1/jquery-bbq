/*
 * jQuery BBQ: Back Button & Query Library - v0.1pre - 9/22/2009
 * http://benalman.com/projects/jquery-bbq-plugin/
 * 
 * Copyright (c) 2009 "Cowboy" Ben Alman
 * Licensed under the MIT license
 * http://benalman.com/about/license/
 */
(function($){var b=this,e,i=document.location,g=Array.prototype.slice,A=decodeURIComponent,a=$.param,j,c,l,n=$.history=$.history||{},k,u,w="hashchange",r="querystring",t="fragment",m="hash",f="href",y="src",h="on"+w in b,o=/^.*\?|#.*$/g,v=/^.*\#/,z={};function p(B){return typeof B==="string"}function s(){var B=g.call(arguments),C=B.shift();return function(){return C.apply(this,B.concat(g.call(arguments)))}}function d(B,K,J,C,F){var H,G,E,I,D;if(C!==e){E=J.match(B?/^([^#]*)\#?(.*)$/:/^([^#?]*)\??([^#]*)(#?.*)/);I=c(E[2]);D=E[3]||"";C=p(C)?c[B?t:r](C):C;G=F===2?C:F===1?$.extend({},C,I):$.extend({},I,C);G=a(G);H=E[1]+(B?"#":G||!E[1]?"?":"")+G+D}else{if(J){H=p(J)?J.replace(K,""):a(J)}else{H=B?i[m]?i[f].replace(K,""):"":i.search.replace(/^\??/,"")}}return H}a[r]=s(d,0,o);a[t]=j=s(d,1,v);$.deparam=c=function(E,C){var D={},B={"true":!0,"false":!1,"null":null};E=p(E)?E:a(E);$.each(E.replace(/\+/g," ").split("&"),function(I,K){var H=K.split("="),L=A(H[0]),G,M=D,J=0,N=L.split("]["),F=N.length-1;if(/\[/.test(N[0])&&/\]$/.test(N[F])){N[F]=N[F].replace(/\]$/,"");N=N.shift().split("[").concat(N);F=N.length-1}else{F=0}if(H.length===2){G=A(H[1]);if(C){G=G&&!isNaN(G)?+G:G==="undefined"?e:B[G]!==e?B[G]:G}if(F){for(;J<=F;J++){L=N[J]===""?M.length:N[J];M=M[L]=J<F?M[L]||(N[J+1]&&isNaN(N[J+1])?{}:[]):G}}else{if($.isArray(D[L])){D[L].push(G)}else{if(D[L]!==e){D[L]=[D[L],G]}else{D[L]=G}}}}else{if(L){D[L]=C?e:""}}});return D};function q(E,D,C,B){if(C===e||typeof C==="boolean"){B=C;C=a[E]()}else{C=p(C)?C.replace(D,""):C}return c(C,B)}c[r]=s(q,r,o);c[t]=l=s(q,t,v);(a.urlAttr=function(B){return $.extend(z,B)})({a:f,base:f,iframe:y,img:y,form:"action",link:f,script:y});function x(E,B,D,C){if(!p(D)&&typeof D!=="object"){C=D;D=B;B=e}return this.each(function(){var H=$(this),F=B||z[(this.nodeName||"").toLowerCase()],G=F&&H.attr(F)||"";H.attr(F,a[E](G,D,C))})}$.fn[r]=s(x,r);$.fn[t]=s(x,t);n.add=k=function(E,D){var C=E!==e,B=p(E)&&/^#/.test(E)?i[f].replace(/#.*$/,"")+E:j(i[f],C?E:{},C?D:2);i[f]=B+(/#/.test(B)?"":"#")};n.retrieve=function(C,B){return C===e||typeof C==="boolean"?l(C):l(B)[C]};n.pollDelay=100;$.event.special[w]={setup:function(){if(h){return false}u.start()},teardown:function(){if(h){return false}u.stop()},add:function(B,D,C){return function(F){var E=F[m]=j();F.retrieve=function(H,G){return H===e||typeof H==="boolean"?c(E,H):c(E,G)[H]};B.apply(this,arguments)}}};u=(function(){var B={},G,C,D,F;function E(){var H,I=$.browser;D=F=function(J){return J};if(I.msie&&I.version<8){H=$("<iframe/>").hide().appendTo("body")[0].contentWindow;F=function(){return H.document.location[m].replace(/^#/,"")};D=function(L,J){if(L!==J){var K=H.document;K.open();K.close();K.location[m]="#"+L}};D(j())}}B.start=function(){C();var I=j();D||E();(function H(){var K=j(),J=F(I);if(K!==I){D(I=K,J);$(b).trigger(w)}else{if(J!==I){k("#"+J,2)}}G=setTimeout(H,n.pollDelay)})()};C=B.stop=function(){G&&clearTimeout(G);G=0};return B})()})(jQuery);